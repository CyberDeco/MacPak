import { Button, VerticalBox, HorizontalBox, LineEdit, ScrollView, ProgressIndicator } from "std-widgets.slint";

// ============================================================================
// Index Search Tab
// ============================================================================
export component IndexSearchTab inherits VerticalBox {
    in-out property <string> query: "";
    in-out property <bool> is-searching: false;
    in-out property <[string]> results: [];
    in-out property <string> status: "";

    // Index management
    in-out property <int> indexed-files: 0;
    in-out property <int> indexed-paks: 0;
    in-out property <bool> is-indexing: false;
    in-out property <float> index-progress: 0.0;

    callback execute();
    callback index-directory();
    callback index-pak();
    callback clear-index();

    padding: 20px;
    spacing: 15px;

    Text {
        text: "Index Search";
        font-size: 24px;
        font-weight: 700;
    }

    Text {
        text: "Search indexed files from PAK archives and directories";
        font-size: 14px;
        color: #666666;
    }

    // Search bar
    HorizontalBox {
        spacing: 10px;
        height: 40px;

        LineEdit {
            placeholder-text: "Enter search query (* and ? wildcards supported)...";
            text <=> root.query;
            horizontal-stretch: 1;
            accepted => { root.execute(); }
        }

        Button {
            text: root.is-searching ? "Searching..." : "Search";
            clicked => { root.execute(); }
            enabled: !root.is-searching && root.query != "";
            primary: true;
        }
    }

    // Index management section
    Rectangle {
        background: #f8f8f8;
        border-radius: 4px;
        height: 60px;

        HorizontalBox {
            padding: 12px;
            spacing: 20px;

            Text {
                text: "Index: " + root.indexed-files + " files from " + root.indexed-paks + " PAKs";
                vertical-alignment: center;
                font-size: 13px;
            }

            Rectangle { horizontal-stretch: 1; }

            Button {
                text: "Index PAK";
                clicked => { root.index-pak(); }
                enabled: !root.is-indexing;
            }

            Button {
                text: "Index Directory";
                clicked => { root.index-directory(); }
                enabled: !root.is-indexing;
            }

            Button {
                text: "Clear Index";
                clicked => { root.clear-index(); }
                enabled: !root.is-indexing && root.indexed-files > 0;
            }
        }
    }

    if root.is-indexing : HorizontalBox {
        spacing: 10px;

        Text { text: "Indexing..."; font-size: 13px; }
        ProgressIndicator {
            progress: root.index-progress / 100.0;
            horizontal-stretch: 1;
        }
        Text { text: Math.round(root.index-progress) + "%"; font-size: 13px; }
    }

    Rectangle { height: 1px; background: #dddddd; }

    // Status
    if root.status != "" : Text {
        text: root.status;
        font-size: 13px;
        color: #666666;
    }

    // Results
    Rectangle {
        background: #f8f8f8;
        border-radius: 4px;
        vertical-stretch: 1;

        if root.results.length == 0 : Text {
            text: root.is-searching ? "Searching..." : "No results. Enter a search query above.";
            font-size: 14px;
            color: #999999;
            horizontal-alignment: center;
            vertical-alignment: center;
        }

        if root.results.length > 0 : ScrollView {
            VerticalBox {
                padding: 10px;
                spacing: 4px;

                for result in root.results : Rectangle {
                    background: white;
                    border-radius: 4px;
                    height: 32px;

                    HorizontalBox {
                        padding-left: 12px;
                        padding-right: 12px;

                        Text {
                            text: result;
                            font-size: 13px;
                            font-family: "monospace";
                            vertical-alignment: center;
                            overflow: elide;
                        }
                    }
                }
            }
        }
    }
}
