import { Button, VerticalBox, HorizontalBox, LineEdit, TextEdit, ListView, ScrollView, StandardButton, ProgressIndicator, ComboBox, Slider, SpinBox, CheckBox } from "std-widgets.slint";

// ============================================================================
// File Entry struct for Asset Browser
// ============================================================================
export struct FileEntry {
    name: string,
    file-type: string,
    size: string,
    modified: string,
    is-dir: bool,
    full-path: string,
    icon: string,
}

// ============================================================================
// Quick Filter Button Component
// ============================================================================
export component QuickFilterButton inherits Rectangle {
    in property <string> label;
    in property <bool> active: false;
    callback clicked();

    background: root.active ? #007AFF : #e8e8e8;
    border-radius: 4px;
    height: 26px;
    border-width: 1px;
    border-color: root.active ? #0066dd : #d0d0d0;

    TouchArea {
        width: 100%;
        height: 100%;
        clicked => { root.clicked(); }
    }

    HorizontalLayout {
        alignment: center;
        padding-left: 10px;
        padding-right: 10px;

        Text {
            text: root.label;
            color: root.active ? white : #333333;
            font-size: 11px;
            font-weight: 500;
            vertical-alignment: center;
        }
    }
}

// ============================================================================
// File Row Component
// ============================================================================
export component FileRow inherits Rectangle {
    in property <FileEntry> entry;
    in property <bool> selected: false;
    in property <bool> alternate: false;
    callback clicked();
    callback double-clicked();
    callback right-clicked(length, length);  // x, y coordinates for context menu

    height: 34px;
    background: root.selected ? #007AFF : (touch.has-hover ? #e8f4fd : (root.alternate ? #fafafa : white));
    border-radius: root.selected ? 4px : 0px;

    touch := TouchArea {
        width: 100%;
        height: 100%;
        clicked => { root.clicked(); }
        double-clicked => { root.double-clicked(); }
        pointer-event(event) => {
            if (event.button == PointerEventButton.right && event.kind == PointerEventKind.up) {
                root.right-clicked(touch.mouse-x, touch.mouse-y);
            }
        }
    }

    HorizontalLayout {
        padding-left: 12px;
        padding-right: 12px;
        spacing: 12px;

        // Icon
        Text {
            text: root.entry.icon;
            font-size: 16px;
            vertical-alignment: center;
            width: 26px;
            horizontal-alignment: center;
        }

        // Name column (flexible)
        Text {
            text: root.entry.name;
            color: root.selected ? white : (root.entry.is-dir ? #1d1d1f : #333333);
            font-weight: root.entry.is-dir ? 700 : 400;
            font-size: 13px;
            vertical-alignment: center;
            overflow: elide;
            horizontal-stretch: 1;
        }

        // Type column
        Text {
            text: root.entry.file-type;
            color: root.selected ? white : #666666;
            font-size: 12px;
            vertical-alignment: center;
            width: 60px;
            horizontal-alignment: center;
        }

        // Size column
        Text {
            text: root.entry.size;
            color: root.selected ? white : #666666;
            font-size: 12px;
            vertical-alignment: center;
            width: 80px;
            horizontal-alignment: right;
        }

        // Modified column
        Text {
            text: root.entry.modified;
            color: root.selected ? white : #666666;
            font-size: 12px;
            vertical-alignment: center;
            width: 120px;
        }
    }
}

// ============================================================================
// Context Menu Item Component
// ============================================================================
export component ContextMenuItem inherits Rectangle {
    in property <string> label;
    in property <string> icon: "";
    in property <bool> enabled: true;
    in property <bool> is-separator: false;
    callback clicked();

    height: root.is-separator ? 9px : 28px;
    background: root.is-separator ? transparent : (touch.has-hover && root.enabled ? #007AFF : transparent);
    border-radius: 4px;

    // Separator line (only visible for separator items)
    Rectangle {
        visible: root.is-separator;
        y: 4px;
        height: 1px;
        background: #e0e0e0;
    }

    // Interactive touch area (always present but disabled for separators)
    touch := TouchArea {
        width: 100%;
        height: 100%;
        enabled: root.enabled && !root.is-separator;
        clicked => { root.clicked(); }
        mouse-cursor: root.enabled && !root.is-separator ? pointer : default;
    }

    // Content layout (hidden for separators)
    HorizontalLayout {
        visible: !root.is-separator;
        padding-left: 10px;
        padding-right: 10px;
        spacing: 8px;

        Text {
            text: root.icon;
            font-size: 13px;
            vertical-alignment: center;
            width: 20px;
            opacity: root.enabled ? 1.0 : 0.4;
        }

        Text {
            text: root.label;
            font-size: 13px;
            color: touch.has-hover && root.enabled ? white : (root.enabled ? #333333 : #999999);
            vertical-alignment: center;
            horizontal-stretch: 1;
        }
    }
}

// ============================================================================
// Context Menu Component
// ============================================================================
export component ContextMenu inherits Rectangle {
    in property <bool> show-menu: false;
    in property <length> menu-x: 0px;
    in property <length> menu-y: 0px;
    in property <string> file-path: "";
    in property <string> file-type: "";
    in property <bool> is-directory: false;
    callback close();
    callback action-open();
    callback action-open-with();
    callback action-show-in-finder();
    callback action-copy-path();
    callback action-convert-lsx();
    callback action-convert-lsf();
    callback action-convert-lsj();
    callback action-delete();

    // Backdrop to catch clicks outside
    if root.show-menu : Rectangle {
        x: -10000px;
        y: -10000px;
        width: 20000px;
        height: 20000px;
        background: transparent;

        TouchArea {
            width: 100%;
            height: 100%;
            clicked => { root.close(); }
        }
    }

    // The menu itself
    if root.show-menu : Rectangle {
        x: root.menu-x;
        y: root.menu-y;
        width: 200px;
        height: menu-content.preferred-height + 12px;
        background: #ffffff;
        border-radius: 8px;
        border-width: 1px;
        border-color: #d0d0d0;
        drop-shadow-blur: 12px;
        drop-shadow-color: #00000033;
        drop-shadow-offset-y: 4px;

        menu-content := VerticalLayout {
            padding: 6px;
            spacing: 2px;

            ContextMenuItem {
                icon: "ðŸ“‚";
                label: root.is-directory ? "Open Folder" : "Open";
                clicked => { root.action-open(); root.close(); }
            }

            ContextMenuItem { is-separator: true; }

            ContextMenuItem {
                icon: "ðŸ“";
                label: "Show in Finder";
                clicked => { root.action-show-in-finder(); root.close(); }
            }

            ContextMenuItem {
                icon: "ðŸ“‹";
                label: "Copy Path";
                clicked => { root.action-copy-path(); root.close(); }
            }

            // Conversion options for Larian files
            if !root.is-directory && (root.file-type == "LSF" || root.file-type == "LSX" || root.file-type == "LSJ") : ContextMenuItem {
                is-separator: true;
            }

            if !root.is-directory && root.file-type == "LSF" : ContextMenuItem {
                icon: "ðŸ”„";
                label: "Convert to LSX";
                clicked => { root.action-convert-lsx(); root.close(); }
            }

            if !root.is-directory && root.file-type == "LSF" : ContextMenuItem {
                icon: "ðŸ”„";
                label: "Convert to LSJ";
                clicked => { root.action-convert-lsj(); root.close(); }
            }

            if !root.is-directory && root.file-type == "LSX" : ContextMenuItem {
                icon: "ðŸ”„";
                label: "Convert to LSF";
                clicked => { root.action-convert-lsf(); root.close(); }
            }

            if !root.is-directory && root.file-type == "LSX" : ContextMenuItem {
                icon: "ðŸ”„";
                label: "Convert to LSJ";
                clicked => { root.action-convert-lsj(); root.close(); }
            }

            if !root.is-directory && root.file-type == "LSJ" : ContextMenuItem {
                icon: "ðŸ”„";
                label: "Convert to LSX";
                clicked => { root.action-convert-lsx(); root.close(); }
            }

            if !root.is-directory && root.file-type == "LSJ" : ContextMenuItem {
                icon: "ðŸ”„";
                label: "Convert to LSF";
                clicked => { root.action-convert-lsf(); root.close(); }
            }

            ContextMenuItem { is-separator: true; }

            ContextMenuItem {
                icon: "ðŸ—‘ï¸";
                label: "Delete";
                clicked => { root.action-delete(); root.close(); }
            }
        }
    }
}
